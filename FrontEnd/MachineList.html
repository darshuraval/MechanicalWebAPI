<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Machine Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-4">
  <h2 class="text-center mb-4">Machine Management</h2>

  <!-- Form for Add/Edit -->
  <div class="card mb-4">
    <div class="card-body">
      <form id="machineForm">
        <input type="hidden" id="machineId">
        <div class="row mb-3">
          <div class="col">
            <input type="text" id="machineName" class="form-control" placeholder="Machine Name" required>
          </div>
          <div class="col">
            <input type="text" id="remarks" class="form-control" placeholder="Remarks">
          </div>
          <div class="col">
            <select id="isActive" class="form-select">
              <option value="true">Active</option>
              <option value="false">Inactive</option>
            </select>
          </div>
          <div class="col">
            <button type="submit" class="btn btn-primary">Save</button>
            <button type="button" class="btn btn-secondary" onclick="resetForm()">Reset</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Machine Table -->
  <table class="table table-bordered table-striped table-hover" id="machineTable">
    <thead class="table-dark">
      <tr>
        <th>Id</th>
        <th>Name</th>
        <th>Remarks</th>
        <th>Active</th>
        <th>Created</th>
        <th>Modified</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const apiBase = "https://localhost:7161"; // replace with your API base URL

// Load machine list
async function loadMachines() {
  try {
    let response = await fetch(`${apiBase}/MachineGetListing`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({})
    });
    let data = await response.json();
    let tbody = document.querySelector("#machineTable tbody");
    tbody.innerHTML = "";
    data.forEach(row => {
      let tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.Id}</td>
        <td>${row.MachineName}</td>
        <td>${row.Remarks ?? ""}</td>
        <td>${row.IsActive ? "Yes" : "No"}</td>
        <td>${row.CreatedDate}</td>
        <td>${row.ModifiedDate}</td>
        <td>
          <button class="btn btn-sm btn-warning me-1" onclick="editMachine(${row.Id})">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteMachine(${row.Id})">Delete</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  } catch(err) {
    console.error("Error loading machines:", err);
  }
}

// Add/Edit machine
document.getElementById("machineForm").addEventListener("submit", async function(e) {
  e.preventDefault();
  let id = document.getElementById("machineId").value;
  let payload = {
    MachineName: document.getElementById("machineName").value,
    Remarks: document.getElementById("remarks").value,
    IsActive: document.getElementById("isActive").value === "true"
  };
  if(id) payload.Id = parseInt(id); // for edit

  let response = await fetch(`${apiBase}/MachineAddEdit`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });
  await response.json();
  resetForm();
  loadMachines();
});

// Edit machine
async function editMachine(id) {
  let response = await fetch(`${apiBase}/MachineGetById`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ Id: id })
  });
  let data = await response.json();
  let row = data[0]; // assuming SP returns array
  document.getElementById("machineId").value = row.Id;
  document.getElementById("machineName").value = row.MachineName;
  document.getElementById("remarks").value = row.Remarks ?? "";
  document.getElementById("isActive").value = row.IsActive ? "true" : "false";
}

// Delete machine
async function deleteMachine(id) {
  if(!confirm("Are you sure you want to delete this machine?")) return;
  await fetch(`${apiBase}/MachineDelete`, { // you need to create this API endpoint
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ Id: id })
  });
  loadMachines();
}

// Reset form
function resetForm() {
  document.getElementById("machineForm").reset();
  document.getElementById("machineId").value = "";
}

// Initial load
loadMachines();
</script>

</body>
</html>
